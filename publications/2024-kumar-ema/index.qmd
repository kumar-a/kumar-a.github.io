---
title: "Disturbance and vegetation structure in an urban forest of Indian Siwaliks"

categories:
  - Disturbance
  - Remote Sensing
  - Phylogenetic Diversity
  - Journal Article
  - Siwalik
  - Taxonomic Diversity
  - Urban Forest

description: ""

author:
  - name: Abhishek Kumar
    url: https://akumar.netlify.app/
    orcid: 0000-0003-2252-7623
    email: abhikumar.pu@gmail.com
    affiliation: Panjab University, Chandigarh
    affiliation-url: https://puchd.ac.in
    
  - name: Pardeep Kumar
    affiliation: Panjab University, Chandigarh
    
  - name: Meenu Patil
    affiliation: Panjab University, Chandigarh
    
  - name: Sabir Hussain
    affiliation: Panjab University, Chandigarh
    
  - name: Rajni Yadav
    affiliation: Panjab University, Chandigarh
    
  - name: Sheenu Sharma
    affiliation: Panjab University, Chandigarh
    
  - name: Diksha Tokas
    affiliation: Panjab University, Chandigarh
    
  - name: Siril Singh
    affiliation: Panjab University, Chandigarh
    
  - name: Anand Narain Singh
    affiliation: Panjab University, Chandigarh
    attributes: 
      corresponding: true
      
doi: "10.1007/s10661-024-12801-0"
            
date: 2024-07-04

draft: false

bibliography: refs.bib

reuse: false

citation:
  type: article-journal
  container-title: "Environmental Monitoring and Assessment"
  doi: "10.1007/s10661-024-12801-0"
  volume: 196
  issue: 8
  page: 691
  
image: thumbnail.jpg

format: 
  html: 
    default-image-extension: "svg"
---

```{r setup, include=FALSE}

## set global chunk options
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE,
                      eval = FALSE, comment = "#>")

## load packages
library(bfast)
library(MODISTools)     ## download and process MODIS data
library(rstatix)        ## pipe friendly statistical tests
library(sf)             ## vector data handling
library(terra)          ## raster data handling
library(tidyverse)      ## general data manipulation and visualisation
library(tmap)           ## visualising spatial data
library(vegan)          ## Vegetation analysis

## additional functions
source("timeser.R")

## colour palette for consistency
mypal <- c(Disturbed = "#D55E00", Undisturbed = "#0072B2")

## theme for ggplot
theme_set(
  theme_bw(base_size = 14) +
    theme(panel.grid = element_blank(),
          strip.background = element_blank(),
          strip.text = element_text(hjust = 0))
)
```

## Abstract

Urban forests are facing multiple human-mediated pressures leading to compromised ecosystem structure and functioning. Therefore, understanding ecosystem structure in response to ongoing pressures is crucial for sustaining ecological integrity and human well-being. We aim to assess the disturbance and its effects on vegetation structure of urban forest in Chandigarh using a combination of remote sensing techniques and vegetation survey. The disturbance was assessed as change in NDVI (Normalised Difference Vegetation Index) from 2001 to 2021 by applying the BFAST (Breaks For Additive Season and Trend) algorithm to the MODIS satellite imagery data. A vegetation survey was conducted to compare the species composition, taxonomic and phylogenetic diversity as measures of vegetation structure. While signals of disturbance were evident, the changes in vegetation structure were not well established from our study. Further, vegetation analysis indicated no significant differences in vegetation composition due to disturbance (*F~1,12~* = 0.91, *p* = 0.575). However, the phylogenetic diversity was substantially lower for disturbed plots as compare to undisturbed plots, though the taxonomic diversity was similar among the disturbed and undisturbed plots. Our results suggests that the effects of disturbance are more prominent on phylogenetic diversity than the taxonomic diversity. These findings can be considered as early signals of disturbance and its effects on vegetation structure of urban forest and contribute to the knowledge base on urban ecology. Our study has implications for facilitating evidence-based decision-making and the development of sustainable management strategies for urban forest ecosystems in Chandigarh.

:::{.callout-note}
This is the original draft, which may differ from published manuscript. Please refer to <https://doi.org/10.1007/s10661-024-12801-0>
:::

## Introduction

Urban forests are vital components of modern cities, providing numerous environmental, social, and economic benefits. These forests influence the well-being of city dwellers through multiple ecosystem services including climate regulation [@Gupta2019], run-off regulation, water supply, air purification and habitat provisions [@Berglihn2021; @Escobedo2011]. The quality of ecosystem services ultimately depend on the biological diversity specifically the vegetation composition [@Elmqvist2013]. Like any other ecosystem, urban forests are subjected to various man-made or natural disturbances that can substantially compromise the ecosystem services through their direct and indirect effects on vegetation composition [@Pickett2011]. Any natural or anthropogenic factor which causes substantial change in some measurable ecosystem state variable is referred as 'disturbance' [@Jentsch2019; @Wohlgemuth2022]. Thus, disturbances in urban forests can arise from both natural and human-induced factors. Natural disturbances include severe weather events such as storms, drought or flooding, insect outbreaks and diseases. Human-induced disturbances encompass activities such as urbanisation, infrastructure development, pollution, logging, fertilisation, use of pesticides and improper management practices [@Wohlgemuth2022]. 

Disturbance events can lead to changes in vegetation composition and species diversity of urban forests through multiple mechanisms [@Laska2001]. Disturbance can regulate the vegetation composition of ecological communities through assembly rules via disturbance filters. In this context, the intermediate disturbance hypothesis states that biodiversity peaks at intermediate levels of disturbance because species adapted to both higher and lower disturbance intensity can coexist at intermediate levels of disturbance [@Connell1978]. However, the effects of disturbance on species diversity may depend on productivity because productivity and disturbance are negatively related to competition [@Huston1994]. Alternatively, the mass-ratio hypothesis states that the dominant species regulates the species diversity through its effects on productivity [@Grime1998]. Further, disturbances can initiate successional processes by creating gaps in the canopy or altering resource availability and therefore, leading to changes in species composition [@Denslow1980]. Non-native invasive species can occupy and dominate these disturbed habitats leading to a decline in native species diversity [@Aryal2022]. Apart from direct disturbance agents, ongoing environmental changes together with expanding urban populations are also projected to indirectly impose severe pressure on structure and functioning of urban forests. Available literature indicates mixed support for either of these hypotheses [@Kershaw2013]. However, there is growing evidence that the disturbance can substantially alter the vegetation structure [@Wohlgemuth2022]. The altered ecosystem structure of urban forests have substantial implications as it can affect the city residents through compromised ecosystem services. Therefore, monitoring and understanding the impacts of disturbance on urban forest structure are crucial for effective management, mitigation of risks, and conservation efforts.

The city Chandigarh is renowned for its meticulously planned urban landscape and abundant green spaces. Its urban forests, comprising parks, gardens, and extensive green belts, contribute significantly to the city's ecological well-being and serve as important reservoirs of biodiversity. However, rapid population growth, human activities, and natural events pose potential threats to the vegetation structure of Chandigarh's urban forests. Further, the lake catchment area also suffers from natural disturbance due to heavy soil erosion during rainy season [@Singh2002]. Ongoing environmental change is expected to increase the frequency of disturbance events by altering the seasonality and intensity of rainfall in the Siwalik region. Thus, the the urban forests of Chandigarh are susceptible to various disturbances that may threaten their integrity and ecological functions. Therefore, detecting and monitoring disturbances in urban forests is essential for the effective management and preservation of these valuable green areas. The objective of present study is to detect the disturbances in urban forests using remote sensing data. Further, this study aims to analyse the vegetation structure in terms of species diversity and vegetation composition in the disturbance affected areas. The ultimate goal is to provide decision-makers, urban planners, and forest management agencies with valuable information to mitigate risks, prioritise conservation efforts, and ensure the long-term sustainability of Chandigarh's urban forests.

## Methodology

### Study site

The present study was conducted in the lake reserve forest of the Sukhna lake catchment area (@fig-site-map). Sukhna lake is a man made reservoir situated in union territory of Chandigarh at Siwalik foothills of lower Himalayas [@Singh2001]. The lake has been declared as a national protective wetland by government of India. The geographical area of Sukhna lake is about 3 km^2^ with an average elevation of 350 m above mean sea level (@fig-site-map). The lake reserve forest spreads over an area of 1.5 km^2^ lies northern side of the lake, harbour several grazers i.e. Sambhar, Asian antelope and several species of reptiles and birds. The vegetation is similar to Siwalik hills comprising of dry mixed deciduous forests with occasional bamboo brakes [@Kumar2022]. Climatic conditions are subtropical monsoon type with annual rainfall of 1110 mm, with maximum temperature of 44&deg;C and minimum 37&deg;C in summer and 14&deg;C during winter as maximum and 3&deg;C as minimum. Soils are alluvial, sandy loam highly susceptible to soil erosion by water run-off action [@Singh2002].

```{r fig.height=5}
##fig-site-map

## Outline of study area
lakefor <- st_read("data/LakeForest.gpkg", quiet = TRUE)
## bounding box for area
sbb <- st_bbox(lakefor) |> st_as_sfc()
## lake reserved forest
lrf <- st_read("data/LakeForest.gpkg", quiet = TRUE) |>
  filter(Name == "Lake Reserve Forest")
## Sukhna lake
sukhna <- st_read("data/LakeForest.gpkg", quiet = TRUE) |>
  filter(Name == "Sukhna Lake")
## Jungle trails
trails <- st_read("data/NatureTrail.gpkg", quiet = TRUE)
## study sites
study_site <- read.csv("data/site_data.csv") |>
  filter(PID2 %in% c(paste0("T", 1:14))) |>
  select(PID, Long, Lat) |>
  st_as_sf(coords = c("Long", "Lat"), crs = 4326)

## inset map
chd <- st_read("E:/spatial-data/admin/ind_adm2/stname_CHANDIGARH.gpkg",
               quiet = TRUE)
insetmap <- tm_shape(chd) + tm_polygons() +
  tm_text("dtname", size = 0.75) +
  tm_shape(sbb) +
  tm_fill(col = "lightpink", alpha = 0.4) + tm_borders(col = "red") +
  tm_layout(frame = FALSE, bg.color = NA)

# aspect ratio for inset map
xy <- st_bbox(chd)
asp <- (xy$ymax - xy$ymin)/(xy$xmax - xy$xmin)


#tmap_mode("plot")

tm_shape(sukhna, bbox = lakefor) + tm_fill(col = "skyblue") +
  tm_borders(col = "darkblue", lwd = 1.25) +

  tm_shape(lrf) + tm_fill(col = "lightgreen", alpha = 0.5) +
  tm_borders(col = "darkgreen", lwd = 1.5) +

  tm_shape(trails) + tm_lines(col = "grey60", lwd = 2, lty = 1) +

  tm_shape(study_site) +
  tm_symbols(shape = 22, size = 0.9, col = "lightpink", alpha = 0.5,
             border.col = "red") +

  tm_shape(lrf) + tm_text("Name", col = "darkgreen", size = 1.2) +
  tm_shape(sukhna) + tm_text("Name", col = "darkblue", size = 1.2) +

  tm_graticules(alpha = 0.3, col = "grey80", labels.size = 0.8) +

  tm_add_legend(type = "symbol", labels = " Sites",
                col = "lightpink", border.col = "red",
                shape = 22, size = 0.9) +
  tm_add_legend(type = "fill", labels = "Forest",
                col = "lightgreen", alpha = 0.5,
                border.col = "darkgreen") +
  tm_add_legend(type = "fill", labels = "Water",
                col = "skyblue", border.col = "darkblue") +
  tm_add_legend(type = "line", labels = "Trail", col = "grey60",
                lwd = 2, lty = 1) +

  tm_compass(position = c(0.94, 0.87)) +

  tm_layout(legend.position = c(0.87, 0.01),
            legend.frame = FALSE,
            legend.text.size = 1)

## add inset map
print(
  insetmap, 
  vp = grid::viewport(0.18, 0.27, width = unit(1.45, "inches"), 
                      height = unit(1.45*asp, "inches"))
)

# tmap_save(
#   filename = "figs/fig1.pdf", width = 8, height = 5, units = "in",
#   outer.margins = 0.025, insets_tm = insetmap,
#   insets_vp = grid::viewport(0.18, 0.27, width = unit(1.45, "inches"),
#                              height = unit(1.45*asp, "inches"))
# )
# 
# tmap_save(
#   filename = "figs/fig1.svg", width = 8, height = 5, units = "in",
#   outer.margins = 0.025, insets_tm = insetmap,
#   insets_vp = grid::viewport(0.18, 0.27, width = unit(1.45, "inches"),
#                              height = unit(1.45*asp, "inches"))
# )
# 
# tmap_save(
#   filename = "figs/fig1.png", width = 8, height = 5, units = "in", dpi = 600,
#   outer.margins = 0.025, insets_tm = insetmap,
#   insets_vp = grid::viewport(0.18, 0.27, width = unit(1.45, "inches"),
#                              height = unit(1.45*asp, "inches"))
# )

## clear the environment
rm(list = ls())
```

![Map showing the geographical location of Sukhna Lake and Lake Reserve Forest in Chandigarh. The sampling plots are indicated as red squares. The inset map shows the location of study sites in Chandigarh city.](figs/fig1){#fig-site-map}

### Satellite data and pre-processing

Since the normalized difference vegetation index (NDVI) has been regarded as a good proxy for vegetation health and biomass, we selected NDVI to assess forest disturbance. The disturbance induced changes in biomass should be reflected as variations in NDVI values. We downloaded all available NDVI values from 2001 to 2021 from MOD13Q1 (version 061) data product using the `R` package `MODISTools` version `r packageVersion("MODISTools")` [@R-MODISTools].

```{r eval=FALSE}
# ## Downloading the NDVI data, starting from 2001-01-01
# modis_ndvi <- mt_subset(
#     product = "MOD13Q1", band = "250m_16_days_NDVI",
#     lat = 30.743, lon = 76.8225,
#     start = "2001-01-01", end = "2021-12-31",
#     km_lr = 2, km_ab = 2,
#     out_dir = "data",
#     site_name = "LRF",
#     internal = TRUE, progress = TRUE
# )
# 
# ## save to local disc
# saveRDS(modis_ndvi,
#         file = "E:/spatial-data/modis/LRF_ndvi_2001-2021.rds")
# 
# # Downloading the pixel reliability data, starting from 2001-01-01
# modis_qa <- mt_subset(
#     product = "MOD13Q1", band = "250m_16_days_pixel_reliability",
#     lat = 30.743, lon = 76.8225,
#     start = "2001-01-01", end = "2021-12-31",
#     km_lr = 2, km_ab = 2,
#     out_dir = "data",
#     site_name = "LRF",
#     internal = TRUE, progress = TRUE
# )
# 
# ## save to local disc
# saveRDS(modis_qa,
#         file = "E:/spatial-data/modis/LRF_qa_2001-2021.rds")
```

The NDVI values of this product are are derived from atmospherically-corrected reflectance in the red, near infra-red, and blue wavebands from the Moderate Resolution Imaging Spectroradiometer (MODIS) instrument mounted on Terra satellite. This data product provides the NDVI values at a spatial resolution of 250 m generated for every 16 days as a Level 3 product [@MODIS]. The algorithm chooses the best available pixel value from all the acquisitions from the 16 day period based on clouds cover, view angle, and the reflectance value. We also downloaded the associated pixel reliability layer to control for pixel values quality. This layer contains simplified ranking of the data that describes overall pixel quality and the good quality data is represented by zero rank [@MODIS].

```{r}
## load the downloaded data
modis_ndvi <- readRDS("E:/spatial-data/modis/LRF_ndvi_2001-2021.rds")
modis_qa   <- readRDS("E:/spatial-data/modis/LRF_qa_2001-2021.rds")

## convert to raster
ndvi_raster <- mt_to_terra(df = modis_ndvi)
qa_raster   <- mt_to_terra(df = modis_qa)

## create mask on pixel reliability flag set all values <0 or >1 as NA
m <- qa_raster

## Keep only good quality data (0 = Good Data) 
m[(qa_raster < 0 | qa_raster > 1)] <- NA

## apply the mask to the NDVI raster
ndvi <- mask(ndvi_raster, m, maskvalue = NA, updatevalue = NA)

## remove the files that are no longer required
rm(modis_ndvi, modis_qa, m, ndvi_raster, qa_raster)
```

```{r}
## function to create time series and apply Savitzky-Golay filter
sgf <- function(x){
  
  ## convert names into dates
  d <- names(x) |> as.Date(format = "%Y-%m-%d")
  
  ## create zoo object
  z <- zoo(x, d)
  
  ## extract the year numbers
  yr <- as.numeric(format(time(z), "%Y"))
  
  ## extract the day numbers (1-365)
  jul <- as.numeric(format(time(z), "%j"))
  
  ## calculate minimum time difference (days) between observations
  delta <- min(unlist(tapply(jul, yr, diff)))
  
  ## aggregate into decimal year timestamps
  zz <- aggregate(z, yr + (jul - 1) / delta / 23)
  
  ## convert into time series object
  tso <- as.ts(zz)
  
  ## fill missing values (NA)
  mts <- forecast::na.interp(tso)
  # mts <- imputeTS::na_seadec(tso)
  
  ## apply Savitzky-Golay filter
  zsgf <- signal::sgolayfilt(mts, p=3, n=9, ts=20) ## 1, 3, 30
  
  return(zsgf)
}

## apply Savitzky-Golay filter
ndvi_sgf <- app(ndvi, sgf)

## add layer names as dates
names(ndvi_sgf) <- names(ndvi)

## remove ndvi and sgf
rm(ndvi, sgf)
```


We acquired a total of 483 images each for NDVI values and associated pixel reliability values. Clear observations with no sub pixel cloud, low aerosol, and low sensor view angle (\<30 degrees) are considered as high quality observations. We selected only reliable good quality pixels by masking out the pixels with no data, marginal data, snow/ice or clouds [see Table 4 in @Didan2015]. This data processing step introduced gaps in our initial NDVI time series and about 6.7% of total pixels had missing values. The missing values were imputed using the `na.interp()` function from the `forecast` package version `r packageVersion("forecast")` [@R-forecast]. This approach first calculates a robust STL-decomposition [@Cleveland1990] followed by a linear interpolation of the seasonally adjusted data, and then, the seasonal component is added back. Next, we used the Savitzky-Golay filter [@Savitzky1964] for smoothing the NDVI time series. This filter was applied using the `R` package `signal` version `r packageVersion("signal")` [@R-signal]. Thus, we created a processed NDVI time series for all pixels in the initial dataset.

```{r}
# Function to create a time series object
# val_array: data array for one single pixel (length is number of time steps)
# time_array: array with dates at which raster data is recorded (same length as val_array)

timeser <- function(val_array, time_array){
  
  ## create zoo object 
  z <- zoo(val_array, time_array)
  
  ## extract the year numbers
  yr <- as.numeric(format(time(z), "%Y"))
  
  ## extract the day numbers (1-365)
  jul <- as.numeric(format(time(z), "%j"))
  
  ## calculate minimum time difference (days) between observations
  delta <- min(unlist(tapply(jul, yr, diff)))
  
  ## aggregate into decimal year timestamps
  zz <- aggregate(z, yr + (jul - 1) / delta / 23)
  
  ## convert into time series object
  (tso <- as.ts(zz))
  return(tso)
}
```

### Detection of disturbance

To assess the forest disturbance, we implemented the Breaks for Additive Seasonal Trends (BFAST) algorithm using the function `bfastmonitor()` function from `R` package `bfast` version `r packageVersion("bfast")` [@R-bfast; @Verbesselt2010a; @Verbesselt2010b]. Basically, this algorithm detects structural changes in both the trend and seasonal components of a STL-decomposed time series. We used the season-trend model to detect the changes in NDVI time series as described earlier [@Verbesselt2012]. This model assumes a linear trend and harmonic season for $y_t$ observations at time $t$.

$$y_t = \alpha_1 + \alpha_2~t + \sum_{j = 1}^k \gamma_j~ \sin \left( \frac{2 \pi j t} {f} + \delta_j \right) + \epsilon_t$$ {#eq-stm}

where the intercept $\alpha_1$, slope $\alpha_2$ (i.e., trend), amplitudes $\gamma_1 \ldots \gamma_k$, and phases $\delta_1 \ldots \delta_k$ (season) are the unknown parameters, $f$ is the known frequency (e.g., $f$ = 23 annual observations for a 16-day time series), and $\epsilon_t$ is the unobservable error term at time $t$ (with standard deviation $\sigma$). To robustly detect disturbances, we used three harmonic terms (i.e., $k$ = 3) to represent a four-month cycle of NDVI [@Verbesselt2012]. The unknown seasonal and trend parameters can be estimated and tested using ordinary least squares (OLS) method [@Cryer2008].

If there is no disturbance, then this season-trend model (@eq-stm) should remain stable for newly added observations. In other words, a disturbance will be detected when the model will no longer remain stable. The stability of model can be estimated using the MOving SUM (MOSUM) test of the OLS residuals ($\hat \epsilon_t$) in the monitoring period $t = n + 1, \ldots, N$

$$MO_t = \frac{1}{\hat \sigma \sqrt{n}} \sum_{s = t - h + 1}^t \left(y_s - x_s^ \top \hat \beta \right)$$ {#eq-mosum}

where $h$ is the bandwidth of the MOSUM and is typically chosen relative to the size of the history sample (e.g., $h = n/4$). The OLS-MOSUM test (@eq-mosum) and least squares are used to determine the number and position of the breakpoints in the seasonally adjusted data ($Y_t-S_t$). The breakpoints are declared if the absolute $|MO_t|$ values fall beyond the 5% probability of structural model stability [@Verbesselt2012]. On the other hand, the $|MO_t|$ should be close to zero with random fluctuations for a structurally stable model [@Verbesselt2012].

Firstly, we detected changes at the end of NDVI time series using the function `bfastmonitor()` [@Verbesselt2012]. This approach first computes the trend, season and other covariates using the STL-decomposition. Then, the data is divided into history and monitoring period. We defined the January 2018 as the start period so that the *history period* is selected from 2001 to 2018 and *monitoring period* was defined as 2018 onwards for the present study. The stable history was selected based on a reversed-ordered-cumulative sum (CUSUM) of residuals, or ROC [@Pesaran2002]. A season-trend model was fitted to this selected stable history period and then, the OLS-MOSUM test was used to detect changes in the monitoring period. If a breakpoint is detected, the timing and magnitude of breakpoint was estimated (@fig-bfmpx). We used the Wilcoxon's rank sum test (also known as Mann-Whitney U test) to compare the disturbance parameters between forest and lake components. This test compares the difference in medians with relaxed assumption of normality of data. We used the `rstatix` package (version `r packageVersion("rstatix")`) to compute the test statistics and associated p-values [@R-rstatix].

```{r fig.height=5}
##fig-bfmpx

## additional functions
source("timeser.R")

tspx <- timeser(
  val_array = unlist(ndvi_sgf[90]),
  time_array = names(ndvi_sgf) |> as.Date("%Y-%m-%d")
)

bfmfit <- bfastmonitor(data = tspx, start = c(2018, 1),
                       formula = response ~ trend + harmon,
                       #formula = response ~ season, sbins = 23,
                       order = 3, history = c("ROC"),
                       type = "OLS-MOSUM", h = 0.25)

# pdf(file = "figs/fig2.pdf", width = 7, height = 5)
# svg(file = "figs/fig2.svg", width = 7, height = 5)
# png(file = "figs/fig2.png", width = 7, height = 5, units = "in", res = 600)

bfmfit |> plot(main = "", xlab = "Time", ylab = "NDVI", las = 1,
               ylim = c(-0.3, 1))

# ## switch off plotting device
# dev.off()
# 
# # bfmfit$breakpoint |> lubridate::date_decimal() |> format("%d-%m-%Y")
```

![Disturbance monitoring for a single location (76.81912$^\circ$E, 30.74081$^\circ$N) in lake reserve forest. A break of 0.03 NDVI units was detected around 16 January 2020.](figs/fig2){#fig-bfmpx}

However, this monitoring approach aims to detect breaks at the end of NDVI time series. Further, it assumes a disturbance free stable history period, which often not a case with real data. Considering these limitations, we focused on a major trend shifts within the NDVI time series. We tested for a single large break using the function `bfast01()` [@Jong2013]. This approach also uses the similar season-trend model and the single breakpoint was estimated by minimising the segmented residual sum of squares. It identifies a single largest break (if MOSUM is significant) for duration 2001-2021 or no break (i.e., MOSUM is not significant). We used a minimum segment size of 69 observations (3 years) to appropriately estimate the regression parameters (2 trend and 6 season parameters) of the season-trend model (@fig-bf01px). These identified breaks or turning points were then characterised using the function `bfast01classify()` and categorised into different types of ecological trend shifts as described earlier [@Bernardino2020].

```{r fig.height=5}
##fig-bf01px

bf01 <- tspx |> bfast01(formula = response ~ trend + harmon,
                        test = "OLS-MOSUM", level = 0.05,
                        bandwidth = (23*3)/483)

# pdf(file = "figs/fig3.pdf", width = 7, height = 5)
# svg(file = "figs/fig3.svg", width = 7, height = 5)
# png(file = "figs/fig3.png", width = 7, height = 5, units = "in", res = 600)

plot(bf01, lwd = c(2, 1.25, 2), ylab = "NDVI", ylim = c(0.2, 1), las = 1)
legend("topleft", #x = 2001, y = 0.9,
       legend = c("Response", "Fitted", "Trend"),
       col = c("grey", "black", "blue"),
       lwd = c(2, 1.25, 2),
       lty = 1, box.lty = 1, horiz = F)

## switch off plotting device
# dev.off()

# time(tspx)[bf01$breakpoints] |> lubridate::date_decimal() |>
#   format("%d-%m-%Y")
```

![Detection of single largest break for location (76.81912$^\circ$E, 30.74081$^\circ$N) in lake reserve forest. The single largest break was detected around 16 January 2018. The trend shift suggests a monotonic increase with a positive break.](figs/fig3){#fig-bf01px}

### Field sampling

To study vegetation composition and species diversity, we pre-defined 14 locations along the lake catchment in the lake reserve forest (@fig-site-map). This prior selection of sampling plot allowed us to avoid any preferential or selection bias while sampling vegetation. We sampled plant species and their abundances using the quadrat method during the flowering season (August-September). We laid a 10 m $\times$ 10 m quadrat at each selected location and recorded the abundance of all woody plants. Herbaceous species were sampled in three randomly laid 1 m $\times$ 1 m quadrats within each 10 m $\times$ 10 m quadrat. A total of 50 quadrats, 14 quadrats for trees and 36 quadrats for herbaceous species were sampled, since two 10 m $\times$ 10 m quadrats had no herbaceous species. The geographic location of each plot was recorded with a handheld GPS (Garmin eTrex 10). Most of the plant species were identified in field and few unidentified plant specimens were collected and photographed for further identification. For identification of plant specimens, we consulted the Herbarium of Panjab University, Chandigarh (PAN) and on-line database [eFlora of India](https://efloraofindia.com/) [@eFI2022]. All the botanical names and their authorities were standardised according to World Checklist of Vascular Plants (WCVP) data version 10 of 27 October 2022 [@Govaerts2021] using the `R` package `rWCVP` version `r packageVersion("rWCVP")` [@R-rWCVP]. Further, all species were broadly categorised into native, introduced and invasive species following the 'Plants of World Online' [@POWO2023] and published alien flora of India [@Khuroo2012]. 

```{r eval=FALSE}
# library(rWCVP)
# 
# abund <- read.csv("data/species_data.csv") |>
#   filter(Sapling == "No") |>
#   distinct(Species)
# 
# abund_match <- wcvp_match_names(abund, name_col = "Species", author_col = NULL,
#                                 fuzzy = TRUE, progress_bar = FALSE)
# 
# abund_match |>
#   left_join(rWCVPdata::wcvp_names, by = c("wcvp_accepted_id"="plant_name_id")) |>
#   select(Species, taxon_name, powo_id, taxon_authors, family, genus) |>
#   arrange(Species) |>
#   filter(!powo_id %in% c("57380-2", "77170576-1", "121424-1", "77229870-1")) |>
#   select(-powo_id) |>
#   write.csv("data/species_wcvp.csv", row.names = FALSE)
```

```{r eval=FALSE}
# ## read the abundance data
# abund <- read.csv("data/species_data.csv") |>
#   filter(Sapling == "No") |>
#   ## rename Species to Search
#   rename("Search" = Species)
# 
# ## Standardise botanical names and save to disk
# abund$Search |> unique() |>
#   lcvplants::lcvp_search() |>
#   select(Search, Output.Taxon, Family, Order) |>
#   separate(Output.Taxon,
#            sep = " ",
#            into = c("Genus", "Species", "Authors"),
#            extra = "merge") |>
#   mutate(Species = paste(Genus, Species)) |>
#   write.csv("data/stand_species.csv", row.names = FALSE)
```

### Phylogenetic information

To analyse the phylogenetic relatedness among the species, we used the recently published GBOTB backbone of phylogeny for seed plants, which is based on data from [GenBank](https://www.ncbi.nlm.nih.gov/genbank/) and [Open Tree of Life](https://tree.opentreeoflife.org/opentree/argus/opentree13.4@ott93302) [@Smith2018]. It is considered as the largest dated phylogeny for 79,881 taxa of seed plants resolved at species level. We used the package `V.PhyloMaker2` (version `r packageVersion("V.PhyloMaker2")`) to prepare a phylogenetic tree for the selected plant species [@R-VPhyloMaker2]. The phylogeny was generated from the `GBOTB.extended.LCVP` mega-tree, which is a combination of two published phylogenies for plants [@Smith2018; @Zanne2014]. Plant names in this phylogenetic tree are standardised according to the Leipzig Catalogue of Vascular Plants (LCVP) [@R-lcvplants], which closely resemble to WCVP [@Govaerts2021]. The nodes were built using the `nodes.info.1.LCVP` function, which returns the most recent common ancestor of all the tips in the largest cluster of the genus, and define it as the basal node of the genus. Further, the phylogeny was generated under the *Scenario 3* for binding of new genus tip to the family branch as defined in earlier study [@Qian2016].

```{r eval=FALSE}
# # devtools::install_github("jinyizju/V.PhyloMaker2")
# library(V.PhyloMaker2)  ## Phylogeny for Vascular Plants
# 
# ## create dataframe to extract phylogeny
# splist <- read.csv("data/species_wcvp.csv") |>
#   select(taxon_name, genus, family) |>
#   rename("Species" = taxon_name, "Genus" = genus, Family = family)
# 
# ## extract phylogenetic tree
# phylo_tree <- phylo.maker(
#   sp.list = splist, tree = GBOTB.extended.LCVP,
#   nodes = nodes.info.1.LCVP, scenarios = "S3"
# )
# 
# ## write the tree to local file
# write.tree(phylo_tree$scenario.3, "data/phylo_wcvp.tre")
```


### Vegetation analysis

To assess the effects of disturbance, we divided the selected vegetation plots into disturbed and undisturbed plots based on the magnitude of NDVI change from `bfastmonitor()` output. If the magnitude of NDVI change was negative, the vegetation plots have been considered as *disturbed* plots (n = 8), whereas vegetation plots with a positive change in NDVI were considered as *undisturbed* plots (n = 6). Then, we compared the vegetation composition and species diversity in the disturbed and undisturbed plots. However, the efforts to measure and compare species diversity often suffer from sampling bias due undetected rare species. Therefore, equalising or standardisation of samples become necessary to measure and compare diversity in an unbiased manner. Traditionally, diversity samples have been standardised by equalising sampling effort, sample size and coverage. Equalising coverage is recommended because it considers both the sample diversity and true diversity [@Roswell2021]. Therefore, to examine sampling completeness of plant species across vegetation plots, we performed coverage-based rarefaction and extrapolation using the `R` package `iNEXT` version `r packageVersion("iNEXT")` [@R-iNEXT].

Traditional diversity metrics such as species richness ($S$) do not incorporate species abundances, and those include species abundances, the Shannon's index [@Shannon1948] and the Simpson's index [@Simpson1949], do not behave intuitively for subsequent addition or removal of species from a community [@Chao2014; @Roswell2021]. To overcome these issues, the use of Hill numbers are recommended [@Roswell2021]. Hill numbers are a series of diversity measures that combines species richness and species abundances [@Hill1973]. Hill number for order $q$ can be defined as:

$$
^qD = \left( \sum_{i = 1}^S p_i^q \right)^{1/(1-q)}
$$ {#eq-hill}

where $p_i$ is the proportion or relative abundance of species $i$, and $S$ is the number of species so that $\sum_{i = 1}^S p_i = 1$. If $n_i$ is the total abundance of species $i$, then the relative abundance can be calculated as $p_i = n_i / \sum_{i = 1}^S n_i$. Many commonly used diversity measures are special cases of Hill numbers [@Chao2014]. When $q = 0$, @eq-hill did not considers the relative abundance of species and get reduced to species richness $S$ (@eq-richness). Although @eq-hill becomes undefined for $q = 1$, its limit as $q$ tends to 1 represents the exponential of Shannon's entropy (@eq-shannon). Similarly, when $q = 2$, the @eq-hill represents the inverse of Simpson concentration (@eq-simpson). The logarithm of Hill numbers represent the corresponding Renyi entropies.

$$
^0D = S
$$ {#eq-richness}

$$
\lim_{q \to 1} ~ {^qD} = {^1D} =  \exp \left( - \sum_{i = 1}^S p_i \log p_i \right)
$$ {#eq-shannon}

$$
^2D = 1 \Big/ \sum_{i = 1}^S p_i^2
$$ {#eq-simpson}

Since the Hill number of order $q = 1$ considers relative abundance of each species, $^1D$ can be interpreted as a measure of the effective number of common species in the assemblage. Similarly, $^2D$ can be interpreted as the effective number of dominant species because it weighs more on the abundant species [@Chao2014]. We compared the first three measures of Hill numbers, i.e., species richness ($q = 0$), Shannon diversity ($q = 1$) and Simpson diversity ($q = 2$) for disturbed and undisturbed plots using the `R` package `iNEXT` version `r packageVersion("iNEXT")` [@R-iNEXT]. We estimated these diversity measures as the mean and 95% confidence intervals of 100 bootstrap replicates for a standardised sample size of 2000 individuals using the `iNEXT()` function. We determined significance of difference by analysing the overlap of the 95% confidence intervals. Whenever the 95% confidence intervals did not overlap, we considered significant difference in species diversity at p < 0.05 [@Colwell2012].

Similarly, we compared phylogenetic diversity (PD) among the disturbed and undisturbed plots. We used the phylogenetic diversity measures of order $q$ based on the Hill number framework [@Chao2010]. If $L_i$ represents the length of branch $i$ and $a_i$ denotes the total relative abundance descended from the $i$th branch for a phylogenetic tree with $B$ branch segments, the mean branch length (weighted by branch relative abundance) can be expressed as $\bar T = \sum_{i = 1}^B L_i a_i$. @Chao2010 defined the phylogenetic diversity of order $q$ as:

$$
^q \text{PD} = \left[ \sum_{i = 1}^B L_i \left( \frac{a_i}{\bar T} \right)^q  \right]^{1/(1-q)}
$$ {#eq-hillpd}

The @eq-hillpd becomes the Faith's PD for $q = 0$, which do not considers the actual total branch length and branch abundances. The measure $^1 \text{PD}$ represents a monotonic transformation of the phylogenetic entropy $H_P$, which weighs each branch proportional to its abundance. The measure $^2 \text{PD}$ is a monotonic transformation of Rao's quadratic entropy $Q$, which puts more weight on abundant/dominant branches and discounts rare branches [@Chao2010; @Hsieh2017]. The rarefaction and extrapolation methods were used to fairly compare these phylogenetic diversity measures across the plots [@Chao2015; @Hsieh2017]. We computed these metrics using the package `iNextPD` version `r packageVersion("iNextPD")` [@R-iNextPD].

Further, we used the Non-metric Multidimensional Scaling (NMDS) to find the similarities and patterns among the species assemblages. NMDS is considered as the most robust unconstrained ordination method in vegetation ecology [@Minchin1987]. The species abundance data was square-root transformed followed by a Wisconsin double standardisation, which involves dividing each species by its maximum and each site by its total. This standardisation minimises the influence of most abundant groups and therefore, prevents overwhelming distance measures of the dominant species. We used the widely recommended Bray-Curtis distance since it has a good rank order relation to ordering sites along gradients [@Faith1987]. The goodness of fit was assessed by the degree of stress, which is a measure of rank-order disagreement between observed and fitted values [@Kruskal1964]. If $d_{ij}$ represents the distance in original dissimilarity matrix and $\hat{d_{ij}}$ represent the fitted distance in ordination space, then the stress (S) can be expressed as @eq-stress: 

$$
S = \sqrt{\frac{\sum_{i = 1}^{n - 1} \sum_{j = i + 1}^{n} (d_{ij} - \hat{d}_{ij})^2}{\sum_{i = 1}^{n - 1} \sum_{j = i + 1}^{n} d_{ij}^2}}
$$ {#eq-stress}

A stress value of greater than 0.2 is generally considered as poor fit leading to risk in interpretation of distances [@Clarke1993]. The NMDS was performed with two dimensions from minimum 20 to maximum 50 random iterations using the function`metaMDS()` from the `vegan` package version `r packageVersion("vegan")` [@R-vegan]. To test the differences in the multivariate centroids of the samples, we used the permutational multivariate analyses of variance (perMANOVA) on the dissimilarity matrix with 9,999 permutations using the `adonis2()` function from the `vegan` package. Across all the computed p-values, we considered p \< 0.05 as significant. All statistical analyses were performed in `R` statistical environment version `r packageVersion("stats")` [@R-base] and package `tidyverse` was used for general data manipulation and visualisation [@R-tidyverse]

## Results

```{r}
source("timeser.R")

## Shape files for boundaries of study area
lakefor <- st_read("data/LakeForest.gpkg", quiet = TRUE)

## dates for the raster
dates <- as.Date(names(ndvi_sgf), "%Y-%m-%d")

## Define a function to apply bfast
bfmRaster <- function(pixels){
  
  ## create a time series of all pixels
  tspx <- timeser(pixels, dates)
  
  ## run bfast on all pixels
  bfm <- bfastmonitor(tspx, 
                      formula = response ~ trend + harmon, 
                      order = 3, 
                      start = c(2018,1))
  
  bfmh <- bfm$history[2] - bfm$history[1]
  
  ## extract breakpoint and magnitude
  return(c(median(tspx),   ## Median NDVI
           bfmh,           ## length of history period
           bfm$breakpoint, ## timing of breakpoint
           bfm$magnitude)) ## Magnitude of breakpoint
}

## apply the function to each raster cell (time series)
bfmR <- app(ndvi_sgf, bfmRaster)

## add layer names
names(bfmR) <- c("Median", "History", "Breaktime", "Magnitude")

## Re-project and crop
bfmR <- bfmR |> project(crs(lakefor)) |> crop(vect(lakefor))
```

The bounds of our study area consisted of total 220 pixels, out of which 58 pixels had their centres within the boundary of lake reserve forest and 52 pixels within the Sukhna lake. The median values of NDVI showed seasonal variations for both forest and lake areas (@fig-monthly-NDVI). In general, the median NDVI values for forest were higher during July to September reaching maximum in August and lower during April to June reaching minimum in May.

```{r fig.height=6}
##fig-monthly-NDVI

## Shape files for boundaries of study area
lakefor <- st_read("data/LakeForest.gpkg", quiet = TRUE)

## Median NDVI for each month
xmon <- names(ndvi_sgf) |> as.Date("%Y-%m-%d") |> months()

monthlyNDVI <- ndvi_sgf |> tapp(index = xmon, median) |>
  project(crs(lakefor)) |> crop(vect(lakefor))

dfmn <- monthlyNDVI |> as.data.frame(xy = TRUE) |>
  pivot_longer(cols = -c(x, y), names_to = "Mnths",
               values_to = "NDVI") |>
  mutate(Mnths = factor(Mnths, levels = month.name))

ggplot() +
  geom_tile(data = dfmn, aes(x = x, y = y, colour = NDVI, fill = NDVI)) +
  geom_sf(data = lakefor, fill = NA, color = "black", linewidth = 0.75) +
    scale_x_continuous(NULL, expand = c(0, 0)) +
    scale_y_continuous(NULL, expand = c(0, 0)) +
  #scale_fill_steps2(low = "#762a86", mid = "#f7f7f7", high =  "#1b7837") +
  scale_colour_fermenter(
    n.breaks = 7, palette = "PRGn", direction = 1,
    guide = guide_colorsteps(title = "Median NDVI", title.vjust = 1,
                           barheight = 0.75, barwidth = 20)
  ) +
  scale_fill_fermenter(
    n.breaks = 7, palette = "PRGn", direction = 1,
    guide = guide_colorsteps(title = "Median NDVI", title.vjust = 1,
                           barheight = 0.75, barwidth = 20)
  ) +
  facet_wrap(. ~ Mnths) +
  theme_bw(base_size = 14) +
  theme(legend.position = "bottom",
        panel.grid = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        strip.background = element_rect(fill = "grey90"),
        strip.text = element_text(colour = "black"))

# ggsave(filename = "figs/fig4.pdf", width = 8, height = 6, units = "in")
# ggsave(filename = "figs/fig4.svg", width = 8, height = 6, units = "in")
# ggsave(filename = "figs/fig4.png", width = 8, height = 6, units = "in",
#        dpi = 600)
```

![Monthly median NDVI values during 2001-2021 for the Sukhna lake and lake reserve forest indicating seasonality in the vegetation and water components.](figs/fig4){#fig-monthly-NDVI}

```{r}
# monthlyNDVI |> terra::extract(lakefor, touches = F, cells = T) |>
#   mutate(ID = case_when(ID == 1 ~"Forest", ID == 2 ~"Lake"),
#          ID = ifelse(test = cell == 88, yes = "Forest", no = ID)) |>
#   pivot_longer(cols = -c(ID, cell), 
#                names_to = "mons", values_to = "NDVI") |>
#   mutate(mons = factor(mons, levels = month.name, labels = month.abb)) |>
#   ggplot(aes(x = mons, y = NDVI, fill = ID, color = ID)) +
#   geom_boxplot(notch = T) +
#   scale_color_manual(values = c(Forest = "#1b7837", Lake = "#762a83")) +
#   scale_fill_manual(values = c(Forest = "#d9f0d3", Lake = "#e7d4e8")) +
#   #scale_fill_manual(values = c(Forest = "#a6dba0", Lake = "#c2a5cf")) +
#   facet_wrap(~ ID, ncol = 1, scales = "free_y") +
#   labs(x = "", y = "NDVI\n") +
#   theme_bw(base_size = 14) +
#   theme(legend.position = "none",
#         panel.grid = element_blank())
```

### Disturbance pattern

During 2001 to 2021, the median NDVI value for the forest was 0.5 reaching a maximum of 0.65. The Sukhna lake had an median NDVI of 0.17 reaching a minimum of --0.19 (@fig-bfm A). A dense patch of vegetation is present in the eastern part of the lake reserve forest. @fig-bfm B shows the length of stable history selected based on ROC to detect changes in the monitoring period. A shorter length of stable history indicates more recent disturbance. The timing and magnitude of breaks detected in NDVI time series are shown in @fig-bfm C and D.

```{r fig.height=6}
##fig-bfm

## convert to data frame
dfr <- bfmR |> as.data.frame(xy = TRUE)

## function for plotting maps
my.map <- function(fill){
  ggplot() +
    geom_tile(data = dfr, aes(x = x, y = y, colour = {{fill}}, fill = {{fill}})) +
    geom_sf(data = lakefor, fill = NA, color = "black", linewidth = 0.75) +
    scale_x_continuous(NULL, expand = c(0, 0)) +
    scale_y_continuous(NULL, expand = c(0, 0)) +
    theme_void() +
    theme(
      legend.direction = "horizontal",
      #legend.justification = "left",
      legend.position = "bottom", #c(0.03, 0.1),
      legend.margin = margin(0.1, 0.1, 0.1, 0.1, "cm"),
      legend.text = element_text(size = 10),
      legend.title = element_text(size = 10),
      legend.background = element_rect(fill = alpha("white", 0.9),
                                       color = NA)
      )
}

## create maps
p1 <- my.map(Median) +
  scale_colour_fermenter(
    palette = "PRGn", direction = 1,
    guide = guide_colorsteps(title = "Median\nNDVI", title.vjust = 1,
                           barheight = 0.5, barwidth = 12)
  ) +
  scale_fill_fermenter(
    palette = "PRGn", direction = 1,
    guide = guide_colorsteps(title = "Median\nNDVI", title.vjust = 1,
                           barheight = 0.5, barwidth = 12)
  )
p2 <- my.map(History) +
  scale_colour_fermenter(
    palette = "RdPu", direction = 1,
    guide = guide_colorsteps(title = "History\n(years)", title.vjust = 1,
                           barheight = 0.5, barwidth = 12)
  ) +
  scale_fill_fermenter(
    palette = "RdPu", direction = 1,
    guide = guide_colorsteps(title = "History\n(years)", title.vjust = 1,
                           barheight = 0.5, barwidth = 12)
  )
p3 <- my.map(Breaktime) +
  scale_colour_fermenter(
    palette = "GnBu", direction = 1,
    guide = guide_colorsteps(title = "Breaktime\n(years)", title.vjust = 1,
                           barheight = 0.5, barwidth = 12)
  ) +
  scale_fill_fermenter(
    palette = "GnBu", direction = 1,
    guide = guide_colorsteps(title = "Breaktime\n(years)", title.vjust = 1,
                           barheight = 0.5, barwidth = 12)
  )
p4 <- my.map(Magnitude) +
  scale_colour_steps2(
    low = "#8c510a", mid = "#f5f5f5", high = "#01665e",
    guide = guide_colorsteps(title = "Magnitude\n(NDVI)", title.vjust = 1,
                           barheight = 0.5, barwidth = 12)
  ) +
  scale_fill_steps2(
    low = "#8c510a", mid = "#f5f5f5", high = "#01665e",
    guide = guide_colorsteps(title = "Magnitude\n(NDVI)", title.vjust = 1,
                           barheight = 0.5, barwidth = 12)
  )

## arrange maps
ggpubr::ggarrange(p1, p2, p3, p4, labels = c("A)", "B)", "C)", "D)"))

# ggsave(filename = "figs/fig5.pdf", width = 8, height = 6, units = "in")
# ggsave(filename = "figs/fig5.svg", width = 8, height = 6, units = "in")
# ggsave(filename = "figs/fig5.png", width = 8, height = 6, units = "in",
#        dpi = 600)
```

![Results of NDVI time series analysis during 2001-2021 for study area. (A) Median NDVI for all MODIS images, (B) Length of stable history period in years, (C) Timing of break in decimal years, and (D) Magnitude of changes in NDVI units.](figs/fig5){#fig-bfm}

The results of Wilcoxon's rank sum test suggested that the forest area has significantly higher median NDVI (*W* = 3225, *p* \< 0.0001), longer stable history period (*W* = 2814, *p* \< 0.0001), more recent timings of breaks during 2019-2021 (*W* = 2592, *p* \< 0.0001), and more positive magnitude of NDVI change (*W* = 3122, *p* \< 0.0001) than the corresponding lake area (@fig-bfm-fl).

```{r}
# bfmR |> terra::extract(vect(lakefor), touches = F, cells = T) |> 
#   pivot_longer(cols = -c(ID, cell), 
#                names_to = "Vars", values_to = "Vals") |>
#   mutate(
#     ID = case_when(ID == 1 ~"Forest", ID == 2 ~"Lake"),
#     ID = ifelse(test = cell == 88, yes = "Forest", no = ID),
#     Vars = factor(Vars, levels = c("Median", "History", "Breaktime",
#                                    "Magnitude"),
#                   labels = c("Median" = "Median NDVI", 
#                              "History" = "History (years)", 
#                              "Breaktime" = "Breaktime (years)",
#                              "Magnitude" = "Magnitude (NDVI)"))
#   ) |> group_by(Vars) |>
#   wilcox_test(Vals ~ ID)
```

```{r fig.height=6}
##fig-bfm-fl

bfmR |> terra::extract(vect(lakefor), touches = FALSE, cells = TRUE) |> 
  pivot_longer(cols = -c(ID, cell), 
               names_to = "Vars", values_to = "Vals") |>
  mutate(
    ID = case_when(ID == 1 ~"Forest", ID == 2 ~"Lake"),
    ID = ifelse(test = cell == 88, yes = "Forest", no = ID),
    Vars = factor(Vars, levels = c("Median", "History", "Breaktime",
                                   "Magnitude"),
                  labels = c("Median" =    "A) Median NDVI", 
                             "History" =   "B) History (years)", 
                             "Breaktime" = "C) Breaktime (years)",
                             "Magnitude" = "D) Magnitude (NDVI)"))
  ) |> 
  
  ggplot(aes(x = ID, y = Vals, color = ID, fill = ID)) +
  geom_boxplot() +
  ggpubr::stat_compare_means(method = "wilcox.test", paired = FALSE,
                             label = "p.signif", label.x.npc = 0.5,
                             color = "red", size = 6) +
  scale_color_manual(values = c(Forest = "#1b7837", Lake = "#762a83")) +
  scale_fill_manual(values = c(Forest = "#d9f0d3", Lake = "#e7d4e8")) +
  #scale_fill_manual(values = c(Forest = "#a6dba0", Lake = "#c2a5cf")) +
  scale_y_continuous(expand = c(0.2, 0)) +
  facet_wrap(~Vars, scales = "free_y") +
  theme(legend.position = "none", axis.title = element_blank())

# ggsave(filename = "figs/fig6.pdf", width = 7, height = 5, units = "in")
# ggsave(filename = "figs/fig6.svg", width = 7, height = 5, units = "in")
# ggsave(filename = "figs/fig6.png", width = 7, height = 5, units = "in",
#        dpi = 600)
```

![Comparison of Median NDVI, Length of stable history, Timing of break, and Magnitude of change in NDVI time series analysis for Sukhna lake (n &equals; 53) and lake reserve forest (n &equals; 61) during 2001-2021. The significance of difference was determined with Wilcoxon's rank sum test and *p*-values <0.0001, <0.001, <0.01, <0.05 and >0.05  corresponds to `****`, `***`, `**`, `*`, and `ns`, respectively.](figs/fig6){#fig-bfm-fl}

The detected single largest shifts in trend component of NDVI were characterised following the recently proposed typology of trend shifts [@Bernardino2020; @R-bfast]. The proposed eight shift types corresponds to (1) monotonic increase, (2) monotonic decrease, (3) monotonic increase (with positive break), (4) monotonic decrease (with negative break), (5) interruption: increase with negative break, (6) interruption: decrease with positive break, (7) reversal: increase to decrease, and (8) reversal: decrease to increase [@Bernardino2020; @R-bfast]. Out of proposed eight types, our study area showed five types of trend shifts in NDVI time series (@fig-bf01-bty).

```{r eval=FALSE}
# ## pixels
# mypx <- c(108, 93, 109, 96, 147)
# 
# ## function to extract plot values
# bf01.to.df <- function(x){
#   z <- timeser(val_array = unlist(ndvi_sgf[x]),
#           time_array = names(ndvi_sgf) |> as.Date("X%Y.%m.%d"))
#   bf <-  bfast01(z)
#   df <- bf |> plot()
#   df$Time <- bf$data$time
#   df$bp <- bf$data$time[bf$breakpoints]
#   return(df)
# }
# 
# ## data list
# datalist <- list()
# 
# for(i in mypx[1:length(mypx)]){
#   dat <- bf01.to.df(i)
#   dat$px <- i
#   datalist[[i]] <- dat
# }
# 
# dplyr::bind_rows(datalist) |>
#   mutate(bty = case_when(
#     px == 108 ~ "(1) Monotonic increase: no break",
#     px == 93 ~ "(3) Monotonic increase: positive break",
#     px == 109 ~ "(5) Interruption: increase with negative break",
#     px == 96 ~ "(7) Reversal: increase to decrease",
#     px == 147 ~ "(8) Reversal: decrease to increase")) |>
#   mutate(bp = replace(bp, px == 108, NA)) |>
#   write.csv("data/break_type.csv", row.names = FALSE)
```

```{r fig.height=7}
##fig-bf01-bty

read.csv("data/break_type.csv") |> 
  
  ggplot(aes(x = Time)) +
  geom_line(aes(y = response), color = "grey80", linewidth = 0.75) +
  geom_line(aes(y = fitted)) +
  geom_line(aes(y = trend), color = "blue", linewidth = 1) +
  geom_vline(aes(xintercept = bp), lty = 2) +
  scale_x_continuous(breaks = c(2005, 2010, 2015, 2020)) +
  facet_wrap(~ bty, ncol = 2) +
  labs(x = "\nTime", y = "NDVI\n") +
  theme(axis.ticks.length = unit(0.15, "cm"))

# ggsave(filename = "figs/fig7.pdf", width = 8, height = 7, units = "in")
# ggsave(filename = "figs/fig7.svg", width = 8, height = 7, units = "in")
# ggsave(filename = "figs/fig7.png", width = 8, height = 7, units = "in",
#        dpi = 600)
```

![Examples of major trend shifts in NDVI time series observed for present study area [@Bernardino2020].](figs/fig7){#fig-bf01-bty}

```{r sing-break}
## Single break type
break.types <- function(x){
  ## create zoo object
  z <- bfastts(data = as.vector(x), 
               dates = as.Date(names(ndvi_sgf), "%Y-%m-%d"),
               type = "16-day")
  ## run bfast01 on all pixels
  bfm <- bfast01(z, formula = response ~ trend + harmon,
                 test = "OLS-MOSUM", order = 3) |>
    bfast01classify()
  ## return breakpoints
  return(bfm$flag_type) 
}

## apply function for each pixel
break_type <- app(ndvi_sgf, break.types)

## not covered under study bound area
break_type[break_type == 6] <- NA

## convert to factor
values(break_type) <- values(break_type) |> as.factor()

bty4326 <- break_type |> 
  project(crs(lakefor)) |> crop(vect(lakefor))

## overall pixels
# bty4326 |> as.data.frame() |> count(lyr.1) |> mutate(prcn = round(n/sum(n)*100, 2))
```

Of the total analysed 218 pixels, about 57% pixels (n = 124) indicated an interrupted increase in NDVI with a negative break and about 17% pixels (n = 38) indicated monotonic increase with positive break whereas about 4% pixels (n = 8) showed consistent monotonic increase with little or no change in NDVI trend during 2001-2021. Further, about 9% pixels (n = 20) indicated a negative reversal from increase to decrease and about 13% pixels (n = 28) indicated positive reversal from decrease to increase in NDVI (@fig-bf01 A).

```{r}
##fig-bf01

dfbf01 <- bty4326 |> as.data.frame(xy = T)


## plot 1
p1 <- ggplot() +
  geom_tile(data = dfbf01, aes(x = x, y = y, colour = lyr.1, fill = lyr.1)) +
  geom_sf(data = lakefor, color = "black", fill = NA, linewidth = 0.75) +

  scale_x_continuous(NULL, expand = c(0, 0)) +
  scale_y_continuous(NULL, expand = c(0, 0)) +

  scale_color_brewer(palette = "Spectral", ) +
  scale_fill_brewer(palette = "Spectral") +
  guides(
    colour = guide_legend(title = "Shift type", title.vjust = 1,
                        keyheight = 0.9, keywidth = 3,
                        label.position = "bottom"),
    fill = guide_legend(title = "Shift type", title.vjust = 1,
                        keyheight = 0.9, keywidth = 3,
                        label.position = "bottom")
  ) +

  theme_void(base_size = 14)

## plot 2
p2 <- bty4326 |> terra::extract(lakefor, touches = F, cells = T) |>
    mutate(
    ID = case_when(ID == 1 ~"Forest", ID == 2 ~"Lake"),
    ID = ifelse(test = cell == 88, yes = "Forest", no = ID)) |>
  count(ID, lyr.1) |>
  ggplot(aes(x = ID, y = n, fill = lyr.1)) +
  geom_bar(stat = "identity", width = 0.75) +
  scale_fill_brewer(palette = "Spectral") +
  labs(x = "", y = "Pixels") +
  theme_bw(base_size = 14) +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank())

cowplot::plot_grid(p1 + theme(legend.position = "bottom"),
                   p2 + theme(legend.position = "none"),
                   rel_widths = c(3, 1), labels = c("A)", "B)"))

# ggsave(filename = "figs/fig8.pdf", width = 7, height = 5, units = "in")
# ggsave(filename = "figs/fig8.svg", width = 7, height = 5, units = "in")
# ggsave(filename = "figs/fig8.png", width = 7, height = 5, units = "in",
#        dpi = 600)
```

![(A) Map showing the spatial distribution of chracterised trend shift types in study area during 2001-2021. (B) Distribution of different shift types across pixels covering the lake reserve forest (n &equals; 61) and Sukhna lake (n &equals; 53). The shift type key corresponds to 1, monotonic increase; 2, monotonic decrease; 3, monotonic increase (with positive break); 4, monotonic decrease (with negative break); 5, interruption: increase with negative break; 6, interruption: decrease with positive break; 7, reversal: increase to decrease; 8, reversal: decrease to increase.](figs/fig8){#fig-bf01}

About 85% pixels (n = 52) covering the forest area depicted a positive trend in NDVI. Out of these 85% pixels, about 8% pixels (n = 5) indicated no break, about 29.5% (n = 18) indicated positive break and 47.5% pixels (n = 29) indicated a negative break in the NDVI time series (@fig-bf01 B). Out of total 61 pixels covering forest area, nine pixels showed a trend reversal in NDVI. Out of these nine pixels, two pixels indicated negative reversal from increasing to decreasing trend in NDVI. On the other hand, out of total 53 pixels covered by Sukhna lake about 64% pixels showed monotonic increase whereas 36% pixels indicated a trend reversal in NDVI. Among 19 pixels indicating a trend reversal, 14 pixels suggested a negative reversal from increasing to decreasing NDVI values whereas five pixels showed a positive reversal (@fig-bf01 B).

### Vegetation structure

```{r}
## total number of individuals
nindiv <- read.csv("data/species_abundance.csv") |>
  filter(Sapling == "No") |>
  select(Number) |> sum()

## total species, genera and family
nspecies <- read.csv("data/stand_species.csv") |> nrow()
ngenera <- read.csv("data/stand_species.csv") |> 
  distinct(Genus) |> nrow()
nfamily <- read.csv("data/stand_species.csv") |> 
  distinct(Family) |> nrow()

## dominant families
# read.csv("data/stand_species.csv") |>
#   count(Family) |> arrange(desc(n)) |> head(4)

## herb, shrub, tree, climbers
# read.csv("data/stand_species.csv") |>
#   left_join(read.csv("data/plant_habit.csv"), by = "Search") |>
#   count(Habit) |> arrange(desc(n))

## native, introduced and invasive
# read.csv("data/species_info.csv") |>
#   count(Invasion)

## common and unique species
# read.csv("data/species_abundance.csv") |>
#   filter(Sapling == "No") |>
#   left_join(
#     select(read.csv("data/site_disturbance.csv"), PID, Disturbance),
#     by = "PID"
#   ) |> 
#   distinct(Disturbance, Species) |> mutate(Vals = TRUE) |>
#   pivot_wider(names_from = "Disturbance", values_from = "Vals", 
#               values_fill = FALSE) |>
#   ggplot() +
#   ggvenn::geom_venn(aes(A = Disturbed, B = Undisturbed),
#                     fill_color = mypal, 
#                     fill_alpha = 0.25,
#                     stroke_color = mypal,
#                     set_name_color = mypal) +
#   coord_fixed() +
#   theme_void()

# ## Inasive species in disturbed and undisturbed plots
# read.csv("data/species_abundance.csv") |>
#   filter(Sapling == "No") |>
#   left_join(
#     select(read.csv("data/site_disturbance.csv"), PID, Disturbance),
#     by = "PID"
#   ) |> select(Species, Disturbance) |>
#   left_join(read.csv("data/species_info.csv"),
#             by = c("Species" = "Search")) |>
#   select(Species, Disturbance, Invasion) |>
#   distinct() |> filter(Invasion == "Invasive") |>
#   mutate(Vals = TRUE) |>
#   pivot_wider(names_from = "Disturbance", values_from = "Vals", 
#               values_fill = FALSE) |>
#   ggplot() +
#   ggvenn::geom_venn(aes(A = Disturbed, B = Undisturbed))
  
```

During the field sampling, we recorded a total of 2,124 individuals representing 38 species of 34 genera belonging to 22 families of flowering plants. These 38 species consisted of 18 herbs, 13 trees, five shrubs and two climbers. Further, 17 species were native and 14 species were invasive to the region, whereas seven species were introduced in the region. Family Fabaceae was most dominant (n = 8) followed by Asteraceae (n = 4), Malvaceae (n = 4) and Poaceae (n = 3). Among all the species, about 50% of total species (n = 19) were present in both disturbed and undisturbed plots. However,  the disturbed plots showed more number of unique species (n = 11) as compared to undisturbed plots (n = 8). Further, nine invasive species were common in both disturbed and undisturbed plots. Interestingly, undisturbed plots recorded greater number of unique invasive species (n = 4) than the disturbed plots (n = 1). Among all the plots, *Oplismenus burmanni* was the most common species, whereas *Ageratum houstonianum* was the most abundant invasive species. 

```{r calc-diversity}
library(iNEXT)

mypal <- c(Disturbed = "#D55E00", Undisturbed = "#0072B2")

## species abundance data
spc <- read.csv("data/species_abundance.csv") |>
  filter(Sapling == "No") |>   ## exclude saplings
  left_join(
    read.csv("data/site_disturbance.csv") |> select(PID, Disturbance)
  ) |> 
  group_by(Disturbance, Species) |>
  summarise(Number = sum(Number)) |>
  pivot_wider(names_from = Disturbance, values_from = Number, 
              values_fill = 0) |>
  column_to_rownames("Species")

## species diversity
specdiv <- iNEXT(x = spc, q = c(0, 1, 2), datatype = "abundance",
                 size = NULL, endpoint = 2000, knots = 40, se = TRUE,
                 conf = 0.95, nboot = 100)

## abundance data
abund <- read.csv("data/species_data.csv") |>
  
  ## add standardised names
  rename("Search" = Species) |>
  left_join(read.csv("data/stand_species.csv")) |>
  
  ## add disturbance class
  left_join(read.csv("data/site_disturbance.csv")) |>
  
  ## prepare data
  filter(Sapling == "No") |>   ## exclude saplings
  select(Species, Disturbance, Number) |>
  group_by(Disturbance, Species) |>
  summarise(Number = sum(Number)) |>
  
  ## convert to species abundance matrix
  pivot_wider(names_from = Disturbance, values_from = Number, 
              values_fill = 0) |>
  mutate(Species = gsub(pattern = " ", replacement = "_", Species)) |>
  column_to_rownames("Species")

## phylogenetic tree
phylo <- readLines("data/phylo.tre")
df <- list(tre = phylo, abund = abund)
df.lab <- rownames(df$abund)
df.phy <- ade4::newick2phylog(df$tre)

# devtools::install_github('JohnsonHsieh/iNextPD')

## iNEXT phylogenetic diversity
phylodiv <- iNextPD::iNextPD(x = df$abund, labels = df.lab, 
                             phy = df.phy, q = c(0, 1, 2), 
                             datatype = "abundance", se = TRUE, nboot = 100)
```

```{r}
## rarefaction curves for species and phylogenetic diversity
# df_specd <- specdiv$iNextEst$coverage_based |>
#   select(-m) |>
#   mutate(Order.q = case_when(Order.q == 0 ~"A) Species richness",
#                              Order.q == 1 ~"B) Shannon diversity",
#                              Order.q == 2 ~"C) Simpson diversity"))
# df_phylo <- bind_rows(
#   mutate(phylodiv$iNextPDEst$Disturbed,   Assemblage = "Disturbed"),
#   mutate(phylodiv$iNextPDEst$Undisturbed, Assemblage = "Undisturbed")
# ) |>
#   rename("Method" = method, "Order.q" = order, 
#          "qD" = qPD, "qD.LCL" = qPD.95.LCL, "qD.UCL" = qPD.95.UCL) |>
#   select(Assemblage, SC, Method, Order.q, qD, qD.LCL, qD.UCL) |>
#   mutate(Method = case_when(Method == "interpolated" ~"Rarefaction",
#                             Method == "extrapolated" ~"Extrapolation",
#                             Method == "observed"     ~"Observed"),
#          Order.q = case_when(Order.q == 0 ~"D) Faith's PD",
#                              Order.q == 1 ~"E) Phylogenetic entropy",
#                              Order.q == 2 ~"F) Rao's Q"))
# bind_rows(df_specd, df_phylo) |>
#   mutate(
#     Method = factor(Method, c("Rarefaction", "Extrapolation", "Observed"))
#   ) |>
#   write.csv("data/diversity_rarefaction.csv", row.names = FALSE)


# ## species and phylogenetic diversity estimates
# phylo_estimates <- phylodiv$AsyPDEst |> as.data.frame() |>
#   pivot_wider(names_from = Var3, values_from = Freq) |>
#   mutate(Var2 = factor(Var2, 
#                        labels = c("q = 0" = "Faith's PD", 
#                                   "q = 1" = "Phylogenetic entropy",
#                                   "q = 2" = "Rao's Q"))) |>
#   rename("Assemblage" = Var1, "Diversity" = Var2, "SE" = "Est_s.e.",
#          "LCL" = "95% Lower", "UCL" = "95% Upper")
# 
# ## combined species and phylogenetic diversity measures
# specdiv$AsyEst |> 
#   rename("SE" = s.e.) |>
#   bind_rows(phylo_estimates) |>
#   write.csv("data/diversity_estimates.csv", row.names = FALSE)


```


```{r fig.height=6}
##fig-diversity

read.csv("data/diversity_rarefaction.csv") |>
  
  ggplot(aes(x = SC, y = qD, colour = Assemblage)) +
  geom_ribbon(aes(ymin = qD.LCL, ymax = qD.UCL, 
                  colour = NULL, fill = Assemblage), alpha = 0.1) +
  geom_line(data = filter(df_div, Method != "Observed"),
            aes(linetype = Method), linewidth = 1.25) +
  geom_point(data = filter(df_div, Method == "Observed"),
             aes(shape = Assemblage), size = 4) +
  facet_wrap(.~Order.q, scales = "free_y") +
  
  labs(x = "\nSample coverage", y = "") +
  
  scale_color_manual(values = mypal) +
  scale_fill_manual(values = mypal) +
  scale_linetype_manual(values = c(1, 3), 
                        labels = c("Interpolation", "Extrapolation")) +
  
  theme(legend.position = "top", legend.title = element_blank())

# ggsave(filename = "figs/fig9.pdf", width = 7, height = 5, units = "in")
# ggsave(filename = "figs/fig9.svg", width = 7, height = 5, units = "in")
# ggsave(filename = "figs/fig9.png", width = 7, height = 5, units = "in",
#        dpi = 600)
```

![Sample coverage-based rarefaction and extrapolation curves of species diversity (A) species richness (q &equals; 0), (B) Shannon diversity (q &equals; 1), and (C) Simpson diveristy (q &equals; 2), and phylogenetic diversity (D) Faith's PD (q &equals; 0), (E) Phylogenetic entropy (q &equals; 1), and (F) Rao's Q (q &equals; 2) based on first three orders of Hill numbers for the disturbed and undisturbed plots in the study region.](figs/fig9){#fig-diversity}

Both species diversity and phylogenetic diversity generally increased with sample coverage (@fig-diversity). However, the rarefaction curves for first three orders of Hill numbers usually overlapped for disturbed and undisturbed plots. Thus, little or no difference was observed in species diversity or phylogenetic diversity due to disturbance. Further, the curves disproportionately represented the rarefaction and extrapolation is achieved for only first order Hill number (Species richness and Faith's PD). Such curves indicate that current samples of vegetation may be incomplete and diversity may differ with increased number of samples.

```{r eval=TRUE}
#| label: tbl-estimates
#| tbl-cap: "Summary of observed and estimated values for species diversity and phylogenetic diversity measures for disturbed (D) and undisturbed (U) vegetation plots. The estimated values are represented as mean &pm; SE and the 95% confidence intervals were estimated with 100 bootstrap replications."

library(gt)

## diversity measures for disturbed sites
disturbed_est <- read.csv("data/diversity_estimates.csv") |> 
  filter(Assemblage == "Disturbed") |>
  mutate(Estimated.d = paste0(round(Estimator, 2), "  ", round(SE, 2)),
         "95% CI.d" = paste0("[", round(LCL, 2), ", ", round(UCL, 2), "]"),
         Observed.d = as.character(round(Observed, 2))) |>
  select(Diversity, Observed.d, Estimated.d, "95% CI.d")

## diversity measures for undisturbed sites
undisturbed_est <- read.csv("data/diversity_estimates.csv") |> 
  filter(Assemblage == "Undisturbed") |>
  mutate(Estimated.u = paste0(round(Estimator, 2), "  ", round(SE, 2)),
         "95% CI.u" = paste0("[", round(LCL, 2), ", ", round(UCL, 2), "]"),
         Observed.u = as.character(round(Observed, 2))) |>
  select(Diversity, Observed.u, Estimated.u, "95% CI.u")

## diversity measures table
left_join(disturbed_est, undisturbed_est, by = "Diversity") |>
  select(Diversity, Observed.d, Observed.u, Estimated.d, Estimated.u,
         "95% CI.d", "95% CI.u") |> 
  
  gt() |>
  tab_spanner("Observed", 2:3) |>
  tab_spanner("Estimated", 4:5) |>
  tab_spanner("95% CI", 6:7) |>
  cols_label(Observed.d = "D", Observed.u = "U",
             Estimated.d = "D", Estimated.u = "U",
             "95% CI.d" = "D", "95% CI.u" = "U") |>
  cols_align(align = "left") |>
    
  tab_options(
    #table.border.top.width = 2,
    #table.border.top.color = "black",
    
    #table.font.size = 10,
    
    column_labels.border.top.width = 2,
    column_labels.border.top.color = "black",
    
    table_body.border.top.color = "black",
    table_body.border.top.width = 1,
    
    table_body.border.bottom.color = "black",
    table_body.border.bottom.width = 2,
    
    table.border.bottom.width = 0,
    table.border.bottom.color = NULL,
    
    # make the width 100%
    table.width = pct(100),
    table.background.color = "white"
  )
  # gtsave(paste0(mypath, "Table1.rtf"))
```

The observed and estimated measures of species and phylogenetic diversity were found to be similar among disturbed and undisturbed plots (@tbl-estimates). Despite non-significant differences, the disturbed plots exhibited higher values of species richness, Shannon diversity and Simpson diversity as compared to undisturbed plots (@fig-div-estimates). Further, the estimated values were substantially higher than the observed values of diversity metrics. On average, the observed species richness and Faith's phylogenetic diversity was 26% lower in disturbed plots and 40% lower in undisturbed plots than the estimated values of species richness. However, the observed and estimated values of Simpson diversity and Rao's Q values were almost identical for both disturbed and undisturbed plots. Among all measures of species and phylogenetic diversity, the 95% confidence intervals were non-overlapping only for Rao's Q values, suggesting that there were significant differences in the Rao's Q phylogenetic diversity for the disturbed and undisturbed plots (@tbl-estimates). The undisturbed plots exhibited significantly higher value of Rao'Q than the disturbed plots.

```{r}
##fig-div-estimates

# read.csv("data/diversity_estimates.csv") |>
#   mutate(Diversity = case_when(
#     Diversity == "Species richness"     ~"A) Species richness",
#     Diversity == "Shannon diversity"    ~"B) Shannon diversity",
#     Diversity == "Simpson diversity"    ~"C) Simpson diversity",
#     Diversity == "Faith's PD"           ~"D) Faith's PD",
#     Diversity == "Phylogenetic entropy" ~"E) Phylogenetic entropy",
#     Diversity == "Rao's Q"              ~"F) Rao's Q"
#   )) |>
#   ggplot(aes(x = Assemblage, y = Estimator, colour = Assemblage, shape = Assemblage)) +
#   geom_linerange(aes(ymin = LCL, ymax = UCL),
#                  linewidth = 4, alpha = 0.1) +
#   geom_errorbar(aes(ymin = Estimator - SE, ymax = Estimator + SE), width = 0.1) +
#   geom_point(size = 4) +
#   facet_wrap(.~Diversity, scales = "free_y") +
#   scale_color_manual(values = mypal) +
#   theme(legend.position = "none",
#         axis.title = element_blank())
# 
# ggsave(filename = "figs/fig10.pdf", width = 7, height = 4.5, units = "in")
# ggsave(filename = "figs/fig10.svg", width = 7, height = 4.5, units = "in")
# ggsave(filename = "figs/fig10.png", width = 7, height = 4.5, units = "in",
#        dpi = 600)
```

![Comparison of asymptotically estimated species and phylogenetic diversity metrics (A) species richness, (B) Shannon's diversity, (C) Simpson's diversity, (D) Faith's phylogenetic diversity, (E) phylogenetic entropy and (F) Rao's quadratic entropy for disturbed and undisturbed vegetation plots [@Chao2010; @Chao2014]. The points represent the estimated mean values, the error bars represent the associated standard error (SE) and the shaded region represent the 95% confidence intervals from 100 bootstrap replications.](figs/fig10){#fig-div-estimates}

Non-metric multidimensional scaling (NMDS) ordination analysis indicated intermixing of disturbed and undisturbed vegetation plots (@fig-nmds). The permutational multivariate analysis of variance (perMANOVA) showed that the disturbed and undisturbed plots did not significantly differ in vegetation composition (*F*~1,12~ = 0.91, *p* = 0.575). There was a good to fair fit of ordination as indicated by relatively low stress (stress = 0.11). Despite high similarity in vegetation composition, two disturbed plots indicated unique species composition. One disturbed plot is solely dominated by *Justicia adhatoda*, whereas other is dominated by *Dendrocalamus strictus* with few *Bougainvillea spectabilis*. 

```{r}
## species abundance data
spv <- read.csv("data/species_data.csv") |>
  filter(Sapling == "No") |>   ## exclude saplings
  select(PID, Species, Number) |>
  group_by(PID, Species) |>
  summarise(Number = sum(Number)) |>
  pivot_wider(names_from = Species, values_from = Number, 
              values_fill = 0) |>
  column_to_rownames("PID")

## calculate bray distance
sp.mat <- as.matrix(spv) |>
  ## transformation to minimize influence of most abundant species
  sqrt() |> wisconsin() |>
  vegdist(method = "bray")

## site variables
sitev <- read.csv("data/site_disturbance.csv") |>
  mutate(PID = as.character(PID), Disturbance = as.factor(Disturbance)) |>
  select(PID, Breaktime, Magnitude, Disturbance)

## NMDS ordination
ord <- metaMDS(comm = sp.mat, distance = "bray", k = 2, try = 20, 
               trymax = 50, autotransform = TRUE, trace = FALSE)

## Do disturbed and undisturbed plots differ in species composition?
set.seed(1254)
otest <- adonis2(sp.mat ~ Disturbance, data = sitev, permutations = 9999)

## extract results and prepare label
otlab <- paste0(
  "italic(F)[", otest$Df[1], "*','*", otest$Df[2], "] == ", 
  round(otest[1, "F"], 2), "*','~~", 
  "italic(p) == ",   round(otest[1, "Pr(>F)"], 3)
)

## convert to data frame
ord_df <- ord$points |> as.data.frame() |>
  rownames_to_column("PID") |>
  inner_join(sitev, by = join_by(PID))
```


```{r fig.height=6}
## fig-nmds

## plot the NMDS result
ggplot(ord_df, aes(x = MDS1, y = MDS2)) +
  geom_hline(yintercept = 0, col = "grey", lty = 2) +
  geom_vline(xintercept = 0, col = "grey", lty = 2) +
  stat_ellipse(aes(fill = Disturbance), geom = "polygon", alpha = 0.1) +
  geom_point(aes(shape = Disturbance, color = Disturbance), size = 4) +
  
  lims(x = c(-2.5, 2.45), y = c(-1.12, 1.2)) +
  annotate(geom = "text", hjust = 0, size = 4, x = -2.5, y = 1.2, 
           label = otlab, parse = TRUE) +
  annotate(geom = "text", hjust = 0, size = 4, x = -2.5, y = 1.0, 
           label = paste0("Stress == ", round(ord$stress, 2)), 
           parse = TRUE) +
  
  scale_color_manual(values = mypal) +
  scale_fill_manual(values = mypal) +
  theme(legend.justification = c(1, 1),
        legend.position = c(1, 1),
        legend.title = element_blank(),
        legend.direction = "horizontal",
        legend.background = element_rect(fill = NA))

# ggsave(filename = "figs/fig11.pdf", width = 7, height = 5, units = "in")
# ggsave(filename = "figs/fig11.svg", width = 7, height = 5, units = "in")
# ggsave(filename = "figs/fig11.png", width = 7, height = 5, units = "in",
#        dpi = 600)
```

![Non-metric multidimensional scaling (NMDS) for differences in species composition between the disturbed and undisturbed vegetation plots. Permutational multivariate analysis of variance (perMANOVA) with 9,999 permutations was used to test the differences between disturbed and undisturbed plots. The goodness-of-fit was assessed by stress value.](figs/fig11){#fig-nmds}

## Discussion

The aims of this investigation were to detect the disturbance and analyse its effects on vegetation structure of urban forest ecosystem. Our analysis of remote sensing data has provided valuable insights about the extent and magnitude of disturbance in urban forest of Chandigarh. Consistent with our expectations, the spatial pattern and severity of disturbance varied for the Sukhna lake and lake reserve forest. Interestingly, the lake reserve forest showed an overall slight positive change in NDVI suggesting lower disturbance and stable vegetation health. The stable vegetation of lake reserve forest can be attributed to the plantation and management efforts of the forest and wildlife department of Chandigarh administration. However, the interface between forest and lake indicated low disturbance as indicated by small negative change in NDVI values. These negative changes indicate a decrease in vegetation density and productivity across the lake-forest interface. This reduction in vegetation can be attributed to various factors, including the dominance of invasive species, increased pollution levels, flooding and limited access to essential resources such as water and nutrients. Thus, multiple factors may contribute to an overall declining vegetation health at the lake margin. Therefore, there is a need to take substantial measures to maintain vegetation at lake-forest interface.

One notable finding was the overall declining trend in NDVI values observed over the Sukhna lake. Sukhna lake not only showed greater decrease in NDVI but also indicated high variation in magnitude of NDVI decrease. In context of Sukhna lake, this trend suggests a degradation of water quality. The negative changes in NDVI reflect the deterioration of the lake ecosystem. These changes can have adverse effects on water quality, biodiversity, and overall ecological balance [@CSE2012]. Since more than half of the Sukhna lake catchment is severely prone to soil erosion [@Semwal2017], sedimentation and siltation appear to be most prominent factor contributing to the declining water quality. Further, it has been suggested that the effects of siltation are more prominent than the urbanisation and climate change [@Singh2019]. Despite numerous efforts from the administration, siltation has remained a major problem during past decades [@Shrimali2001; @Singh2002]. Apart from siltation, the degraded water quality can be attributed to numerous factors including pollution, sedimentation or changes in water flow patterns. These findings align with previous studies highlighting the degradation of the Sukhna lake [@Maansi2021; @Singh2019].

Our study indicated that both lake reserve forest and Sukhna lake are experiencing substantial changes in ecosystem health during the past two decades [@Singh2002]. These findings highlight the vulnerability of urban forests to anthropogenic influences and the need for effective management and conservation strategies. The multi-temporal remote sensing datasets are useful for monitoring the temporary and long-term disturbances [@Verbesselt2012]. The integration of satellite imagery analysis and statistical algorithms are emerging as potential tools for monitoring changes in vegetation patterns due to climate change or invasive species encroachment. Such studies can provide valuable insights into the vegetation dynamics in urban forests due to disturbance events. However, the accuracy and reliability of disturbance detection need to be further enhanced by incorporating ground data and validation techniques. The remote sensing approach can prove to be a powerful tool for identification and mapping of various disturbances such as construction activities, pollution, invasive species, and climate change impacts. Such techniques can capture large-scale disturbances, enabling comprehensive assessments and informed decision-making for forest management.

Another objective of present study was to analyse the effects of disturbance events on vegetation structure of urban forests and therefore, we compared the taxonomic and phylogenetic diversity between the disturbed and undisturbed plots. Contrary to our expectations, we did not find any significant differences in taxonomic and phylogenetic diversity metrics for the disturbed vegetation plots as compared to undisturbed plots. The species richness and Simpson diversity was similar for the disturbed and undisturbed plots suggesting that disturbance had little influence on the species richness and Simpson diversity. However, the Shannon's diversity was higher for disturbed plots than the undisturbed plots, though there was little statistical evidence for significant differences. The higher Shannon's diversity in disturbed plots indicate that disturbance might have promoted the evenness of species. Further, disturbance may have selectively promoted some species while discouraging others. These findings are consistent with previous studies investigating the disturbance effects on vegetation structure [@Erfanian2021; @Gogoi2018]. However, multiple direct and indirect effects of disturbance can shape the  biodiversity and vegetation structure [@Bowd2021; @Roman2018].

An important finding of the present study is the significantly lower phylogenetic Rao's Quadratic Entropy (Rao's Q) for disturbed plots as compared to the undisturbed plots (@fig-div-estimates F). The lower phylogenetic diversity of disturbed plots suggests the presence of closely related evolutionary lineages. On the other hand, the higher phylogenetic diversity of undisturbed plots suggests presence of species from diverse evolutionary lineages. It appears that disturbance events discourage the coexistence of species lineages that are more distantly-related in evolutionary history. Disturbance may promote phylogenetically similar species reducing the phylogenetic diversity of species within a community. This observation is complemented by lower levels of Faith's phylogenetic diversity (PD) and phylogenetic entropy for disturbed plots. The lower levels of Faith's PD for disturbed plots indicates the presence of species with shared evolutionary history. Similarly, the lower phylogenetic entropy for disturbed plots suggests species are clustered on the phylogenetic tree indicating dominance or specialisation of some specific lineages. These findings align with previous studies examining the disturbance effects on phylogenetic structure of vegetation [@Dinnage2009; @Erfanian2021; @Liendo2020].

Our study suggest that the effects of disturbance are more prominent on phylogenetic structure of vegetation as compared to taxonomic diversity. While taxonomic diversity remained similar, the phylogenetic diversity appeared to be declined under the influence of disturbance. This reduction could be a result of indirect effects of disturbance through various factors, such as invasive species, climate change or altered community dynamics. Invasive species were found to have a considerable influence on the vegetation structure in the urban forests [@Aryal2022]. The encroachment of invasive species, such as *Lantana camara* and *Prosopis juliflora*, might have disrupted the native plant communities, reducing the phylogenetic diversity and altering the composition of the forest under-story. The spread of invasive species can also affect ecosystem processes, such as nutrient cycling [@Patil2020], further impacting the overall vegetation structure and ecological functioning of the urban forests. Ongoing climate change is another important factor affecting the vegetation structure in urban forests. Specifically, hydrological disturbance due to erratic frequency and intensity of rainfall events might have impacted the tree growth, species composition, and overall forest structure [@Shafroth2002]. Further, water logged conditions and increased susceptibility to diseases may be leading to decreased tree vitality and increased mortality rates in some areas.

## Conclusion

In conclusion, our study provides the initial signals of disturbance and its effects on vegetation structure in urban forest of Chandigarh. Our findings indicate that the Sukhna lake and adjacent reserved forest are experiencing substantial changes in their hydrological and ecological conditions. These changes are more prominent for Sukhna lake and adjacent riparian forest zone, indicating prevalence of multiple disturbance agents. However, little changes were observed in species diversity and composition of forest vegetation. While the taxonomic diversity was similar, the phylogenetic diversity was substantially lower in disturbed plots as compared to undisturbed plots. These findings highlight the importance of monitoring the disturbance and its effects on the vegetation structure. Further, our study emphasises the integration of remote sensing technologies and ground surveys while monitoring and managing the urban forest ecosystems. Timely interventions, such as habitat restoration, invasive species management, and urban planning, can aid in preserving the integrity and functionality of the urban forest ecosystem. Finally, we call for a collaborative approach involving various stakeholders, including city planners, policy-makers, environmentalists, and local communities, to achieve sustainable management and conservation of urban forests. 

## Acknowledgments {.appendix}

Authors are thankful to Forest and Wildlife Department, Chandigarh for providing permission to conduct study in Sukhna lake catchment area.

## Data availability {.appendix}

The data and R codes that support the findings of this study are openly available in figshare at <https://doi.org/10.6084/m9.figshare.24531031>

## References
